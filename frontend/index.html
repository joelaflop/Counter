<!DOCTYPE html>
<html lang="en">

<head>
   <meta charset="UTF-8">
   <!-- https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP -->
   <!-- <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self'"> -->
   <meta http-equiv="X-Content-Security-Policy" content="default-src 'self'; script-src 'self'">
   <link href="app/css/main.css" rel="stylesheet" type="text/css" />
</head>

<body>
   <div class="container-fluid maincontainer bg-darkgray">
      <div class="maintable main-page">
         <div class="tablecell leftbar bg-black garamond-font pt-3 pl-2 pr-0">
            <nav class="navbar navbar-nav navbar-expand-lg navbar-dark px-0">
               <ul class="navbar-nav flex-column leftbarmovementfix">
                  <a class="navbar-brand pl-0" href="#">Counter</a>
                  <li class="nav-item">

                     <a id="recently played button" class="nav-link py-1 pl-1 pr-0" href="#">
                        <img src="app/img/icons/clock-history.svg" class="invert pb-1 pr-1" alt="" width="25"
                           height="25" title="Bootstrap">history</a>
                  </li>
                  <li class="nav-item">
                     <a id="user page button" class="nav-link py-1 pl-1 pr-0" href="#">
                        <img src="app/img/icons/person-square.svg" class="invert pb-1 pr-1" alt="" width="25"
                           height="25" title="Bootstrap">user</a>
                  </li>
                  <li class="nav-item">
                     <a id="data page button" class="nav-link py-1 pl-1 pr-0" href="#">
                        <img src="app/img/icons/clipboard-data.svg" class="invert pb-1 pr-1" alt="" width="25"
                           height="25" title="Bootstrap">data</a>
                  </li>
               </ul>
            </nav>
         </div>
         <div id="mainpage" class="tablecell avoidleftbar garamond-font">
            <div class="pagetitlebox bg-gray">
               <h4 class="pagetitle text-white">welcome</h4>
            </div>
         </div>
      </div>
      <nav class="navbar fixed-bottom garamond-font bg-gray text-white pt-0 pl-0">
         <div class="maintable">
            <div class="tablecell leftbar">
               <h4 class="p-1 pt-3">now playing</h4>
            </div>
            <div class="tablecell avoidleftbar">
               <div id="nowplaying"></div>
            </div>
         </div>
      </nav>
   </div>


   <div id="countsPage">
      <div class="pagetitlebox bg-gray">
         <h4 class="pagetitle text-white">history</h4>
      </div>
      <div id="recentlyplaying" class="mainpagedrop"></div>
   </div>

   <div id="userPage">
      <div class="pagetitlebox bg-gray">
         <h4 class="pagetitle text-white">user profile</h4>
      </div>
      <div id="usermainpage" class="mainpagedrop"></div>
   </div>

   <div id="dataPage">
      <div class="pagetitlebox bg-gray">
         <h4 class="pagetitle text-white">data insights</h4>
      </div>
      <div id="datamainpage" class="mainpagedrop"></div>
   </div>

   <!-- You can also require other files to run in this process -->
   <script src="app/js/mainRenderer.js"></script>
   <!-- <script src="http://code.jquery.com/jquery-1.10.1.min.js"></script> -->
   <script src="https://cdn.jsdelivr.net/npm/handlebars@latest/dist/handlebars.js"></script>
   <script src="./app/resources/Handlebars/track_object_full.precompiled.js"></script>
   <script src="./app/resources/Handlebars/user_object.precompiled.js"></script>

   <script>
      var full_track_template = Handlebars.templates.track_object_full;
      ipcRenderer.on("auth-button-task-finished", function (event, arg) {
         console.log("renderer got confirmation of authbutton click")
      });
      ipcRenderer.on("nowplaying-button-task-finished", function (event, track) {
         console.log('got a nowplaying finish')
         if (track === "nothingplaying") {
            let nothingplayingdiv = document.createElement('div');
            document.getElementById('nowplaying').innerHTML = 'were not playing nothing'
         } else {
            document.getElementById('nowplaying').innerHTML = full_track_template(track)
         }
      });
      ipcRenderer.on("recentlyplayed-button-task-finished", function (event, tracks) {
         parent = document.getElementById('recentlyplaying')
         parent.innerHTML = ""
         for (let i = 0; i < tracks.length; i++) {
            console.log(tracks[i])
            child = document.createElement('div');
            child.className = "text-white";
            appendChild = parent.appendChild(child)
            appendChild.innerHTML = full_track_template(tracks[i]);
            // console.log(1)
         }
      });
   </script>

   <script>
      var user_template = Handlebars.templates.user_object;
      ipcRenderer.on("user-button-task-finished", function (event, user) {
         console.log('got a user page finish')
         console.log(user)
         document.getElementById('usermainpage').innerHTML = user_template(user)
      });
   </script>
</body>

</html>